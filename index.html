<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Daftar Ulang</title>
</head>
<body>
  <h2>Form Daftar Ulang</h2>
  <form id="myForm">
    <label>ID Santri: <input type="text" name="id_santri" required></label><br><br>
    <label>BOP: <input type="number" name="bop"></label><br><br>
    <label>Sarpras: <input type="number" name="sarpras"></label><br><br>
    <label>Kegiatan: <input type="number" name="kegiatan"></label><br><br>
    <label>Perlengkapan: <input type="number" name="perlengkapan"></label><br><br>
    <label>Alamat: <input type="text" name="alamat"></label><br><br>
    <label>No WA: <input type="text" name="no_wa"></label><br><br>
    <button type="submit">Kirim</button>
  </form>

  <p id="status"></p>

  <iframe id="hidden_iframe" name="hidden_iframe" style="display:none;"></iframe>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzNzE66l5HLoMVQ119g0M4AxXFEtZy_GnWehxhY_Q1ml0POZKxyl6JXFC17Gguz42-iYw/exec"; // ganti URL Web App

    const form = document.getElementById("myForm");
    const statusEl = document.getElementById("status");

    form.addEventListener("submit", async function(e) {
      e.preventDefault();
      statusEl.textContent = "Mengirim...";

      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch(WEBAPP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error("Fetch gagal");
        const out = await res.json();
        statusEl.textContent = out.message;
      } catch (err) {
        // fallback ke iframe
        statusEl.textContent = "Fetch gagal, coba metode alternatif...";
        const iframeForm = document.createElement("form");
        iframeForm.action = WEBAPP_URL;
        iframeForm.method = "POST";
        iframeForm.target = "hidden_iframe";

        const hiddenInput = document.createElement("input");
        hiddenInput.type = "hidden";
        hiddenInput.name = "json";
        hiddenInput.value = JSON.stringify(data);

        iframeForm.appendChild(hiddenInput);
        document.body.appendChild(iframeForm);
        iframeForm.submit();
        iframeForm.remove();

        statusEl.textContent = "Data terkirim via fallback (iframe).";
      }
    });
  </script>
</body>
</html>
